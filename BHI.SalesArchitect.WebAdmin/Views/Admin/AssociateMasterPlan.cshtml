@using BHI.SalesArchitect.Model.DB
@using System.Security.Claims
@using Microsoft.AspNetCore.Mvc.ViewFeatures
@model List<MasterPlan>
@{
    Layout = null;
}
<style>
    .associate-master-ui #plan-update {
        float: right;
    }

    .associate-master-ui .control-label {
        width: 130px !important;
    }

    .associate-master-ui .controls {
        text-align: left;
    }
</style>
<form asp-controller="Admin" asp-action="AssociateMasterPlan" method="post" class="form-horizontal associate-master-ui">
    <input type="hidden" name="communityID" value="@ViewData["communityID"]" />
    <label id="errormessage1" style="color:red;font-weight:bold"></label>
    <div class="control-group">
        <label for="masterPlanId" class="control-label">
            Master Plan:
        </label>
        <div class="controls">
            <select id="masterPlanID" name="masterPlanID" class="form-control input-medium">
                @foreach (var masterPlan in Model)
                {
                    if (masterPlan.MapData == "selected")
                    {
                        <option value="@masterPlan.Id" selected="selected">@masterPlan.Name</option>
                    }
                    else
                    {
                        <option value="@masterPlan.Id">@masterPlan.Name</option>
                    }
                }
            </select>
        </div>
    </div>
    <a style="cursor:pointer" id="expandeditPlan">Change selected plan name</a>
    <button type="submit" class="btn btn-primary" id="plan-update">Update</button>
</form>

<div class="form-horizontal associate-master-ui" style="display:none" id="changemasterplanname">
    <br /><br />
    <label id="errormessage" style="color:red;font-weight:bold"></label>
    <div class="control-group">
        <label for="masterPlanId" class="control-label">
            New Master Plan:
        </label>
        <div class="controls">
            <input type="text" id="newPlanname" class="form-control" />
        </div>
    </div>
    <button type="button" class="btn btn-primary" id="planname-update">Update Planname</button>
    <button type="button" class="btn btn-primary" id="planname-cancel">Cancel</button>
</div>

<script type="text/javascript">
    $(document).ready(function () {
        $('#expandeditPlan').click(function () {
            if ($('#masterPlanID').val() == 0) {
                $('#errormessage1').text('Please select "Master Plan".');
            } else {
                $('#masterPlanID').attr('disabled', true);
                $('#plan-update').attr('disabled', true);
                $('#changemasterplanname').css('display', '');
                $('#errormessage1').text('');
                $('#newPlanname').val('');
            }
            $('#errormessage').text('');
        });
        $('#planname-update').click(function () {
            var oldplanId = $('#masterPlanID').val();
            var newplanname = $('#newPlanname').val();
            if (newplanname == '') {
                $('#errormessage').text('Please enter a value in "New Master Plan" Field.');
            }
            else {
                $('#errormessage').text('');
                UpdateMasterPlanName(oldplanId, newplanname, $('#masterPlanID'));
            }
        });
        $('#planname-cancel').click(function () {
            $('#masterPlanID').attr('disabled', false);
            $('#plan-update').attr('disabled', false);
            $('#changemasterplanname').css('display', 'none');
            $('#errormessage1').text('');
            $('#newPlanname').val('');
        });
    });
</script>
